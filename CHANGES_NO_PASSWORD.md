# üîê –ò–∑–º–µ–Ω–µ–Ω–∏—è: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–æ—â–µ–Ω–∞ - —Ç–µ–ø–µ—Ä—å **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ –∫–æ–¥–∞–º**, –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π!

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è Backend

### 1. –£–±—Ä–∞–Ω—ã –ø–æ–ª—è

#### `Customer` schema
```diff
- @Prop({ required: true })
- passwordHash: string;

- @Prop()
- telegramUsername: string;
```

#### `RegisterDto`
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 2 DTO:
  - `RegisterEmailDto`: `{ name, email }`
  - `RegisterTelegramDto`: `{ name, phone }`
- ‚ùå –£–±—Ä–∞–Ω–æ: `password`, `telegramUsername`, `verificationMethod`

#### `LoginDto`
```diff
- password: z.string().min(1, 'Password is required'),
```

### 2. –ù–æ–≤—ã–µ endpoints

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```typescript
// –ë—ã–ª–æ
POST /auth/register
{
  name, email, phone, password,
  verificationMethod, telegramUsername
}

// –°—Ç–∞–ª–æ (2 endpoint)
POST /auth/register/email
{ name, email }

POST /auth/register/telegram
{ name, phone }
```

#### Login
```typescript
// –ë—ã–ª–æ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
POST /auth/login
{ email, password }
‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω

// –°—Ç–∞–ª–æ - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞
POST /auth/login
{ email OR phone }
‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥, –Ω—É–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã

#### `auth.service.ts`
- ‚úÖ –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
  - `registerEmail(dto)` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ email
  - `registerTelegram(dto)` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ phone
- ‚ùå –£–±—Ä–∞–Ω–æ:
  - `bcrypt.hash()` - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
  - `bcrypt.compare()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª–µ–π
  - –õ–æ–≥–∏–∫–∞ —Å `passwordHash`

#### `auth.controller.ts`
- ‚úÖ –ù–æ–≤—ã–µ routes:
  - `POST /auth/register/email`
  - `POST /auth/register/telegram`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `POST /auth/login` - —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è Frontend

### 1. RegisterStep - 2 —Ñ–æ—Ä–º—ã

#### Email —Ñ–æ—Ä–º–∞
```typescript
{
  name: string;
  email: string;
}
```

#### Telegram —Ñ–æ—Ä–º–∞
```typescript
{
  name: string;
  phone: string;
}
```

#### UI
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É Email / Telegram
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—ã –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –£–±—Ä–∞–Ω–æ: `password`, `confirmPassword`, `telegramUsername`

### 2. API Client

```typescript
// –ë—ã–ª–æ
authApi.register({ name, email, phone, password, ... })

// –°—Ç–∞–ª–æ
authApi.registerEmail({ name, email })
authApi.registerTelegram({ name, phone })
```

### 3. VerifyStep

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ email –∏ phone
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –∏–∑ localStorage
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéØ User Flow —Ç–µ–ø–µ—Ä—å

### Email —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```
1. RegisterStep (Email —Ñ–æ—Ä–º–∞)
   ‚Üì –í–≤–æ–¥–∏—Ç: name, email
   
2. Backend —Å–æ–∑–¥–∞–µ—Ç customer –±–µ–∑ –ø–∞—Ä–æ–ª—è
   ‚Üì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ email
   
3. VerifyStep
   ‚Üì –í–≤–æ–¥–∏—Ç –∫–æ–¥ –∏–∑ email
   
4. –£—Å–ø–µ—Ö ‚Üí –¢–æ–∫–µ–Ω ‚Üí –î–∞—à–±–æ—Ä–¥
```

### Telegram —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```
1. RegisterStep (Telegram —Ñ–æ—Ä–º–∞)
   ‚Üì –í–≤–æ–¥–∏—Ç: name, phone
   
2. Backend —Å–æ–∑–¥–∞–µ—Ç customer –±–µ–∑ –ø–∞—Ä–æ–ª—è
   ‚Üì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –≤ Telegram
   
3. VerifyStep
   ‚Üì –í–≤–æ–¥–∏—Ç –∫–æ–¥ –∏–∑ Telegram
   
4. –£—Å–ø–µ—Ö ‚Üí –¢–æ–∫–µ–Ω ‚Üí –î–∞—à–±–æ—Ä–¥
```

### Login
```
1. –í–≤–æ–¥–∏—Ç: email –ò–õ–ò phone
   
2. Backend –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Üì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥
   
3. VerifyStep
   ‚Üì –í–≤–æ–¥–∏—Ç –∫–æ–¥
   
4. –£—Å–ø–µ—Ö ‚Üí –¢–æ–∫–µ–Ω ‚Üí –î–∞—à–±–æ—Ä–¥
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–∞—Ä–æ–ª—è–º–∏:

```javascript
// MongoDB migration
db.customers.updateMany(
  {},
  { 
    $unset: { 
      passwordHash: "",
      telegramUsername: ""
    }
  }
);
```

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### Backend (7 —Ñ–∞–π–ª–æ–≤)
1. `src/auth/dto/register.dto.ts` - 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö DTO
2. `src/auth/dto/login.dto.ts` - —É–±—Ä–∞–Ω password
3. `src/auth/auth.controller.ts` - 2 endpoint —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
4. `src/auth/auth.service.ts` - —É–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π
5. `src/customer/schemas/customer.schema.ts` - —É–±—Ä–∞–Ω—ã –ø–æ–ª—è
6. `src/customer/dto/create-customer.dto.ts` - —É–±—Ä–∞–Ω—ã –ø–æ–ª—è
7. (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `src/customer/customer.repository.ts` - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### Frontend (3 —Ñ–∞–π–ª–∞)
1. `frontend/components/steps/RegisterStep.tsx` - 2 —Ñ–æ—Ä–º—ã
2. `frontend/components/steps/VerifyStep.tsx` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ phone
3. `frontend/lib/api.ts` - –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã API

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ü—Ä–æ—â–µ** - –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ** - –º–µ–Ω—å—à–µ –ø–æ–ª–µ–π –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ** - –Ω–µ—Ç —Å–ª–∞–±—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ **–£–¥–æ–±–Ω–µ–µ** - –æ–¥–∏–Ω –∫–ª–∏–∫, –æ–¥–∏–Ω –∫–æ–¥

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞** - –Ω–µ—Ç –ª–æ–≥–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ **–ú–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º** - –Ω–µ—Ç "–∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å"
- ‚úÖ **–ü—Ä–æ—â–µ** - –Ω–µ –Ω—É–∂–µ–Ω bcrypt
- ‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** - –∫–∞–∫ —É –∫—Ä—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üöÄ –ó–∞–ø—É—Å–∫

### 1. Backend
```bash
npm run start:dev
```

### 2. Frontend
```bash
cd frontend
npm run dev
```

### 3. –¢–µ—Å—Ç

**Email —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3001
2. –í—ã–±–µ—Ä–∏—Ç–µ "Email"
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ email
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email (–∏–ª–∏ –ª–æ–≥–∏ backend)
5. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥

**Telegram —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3001
2. –í—ã–±–µ—Ä–∏—Ç–µ "Telegram"
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram
5. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Backend API**: –°–º. Swagger –∏–ª–∏ –ª–æ–≥–∏
- **Frontend**: –°–º. `frontend/README.md`
- **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –°–º. `src/verification/`

## ‚ùì FAQ

### –ß—Ç–æ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏?
–ï—Å–ª–∏ —É –≤–∞—Å –±—ã–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–∞—Ä–æ–ª—è–º–∏ - –Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î (—Å–º. –≤—ã—à–µ).

### –ö–∞–∫ —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞—Ç—å login?
–ü—Ä–æ—Å—Ç–æ –≤–≤–æ–¥–∏—Ç–µ email –∏–ª–∏ phone - –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ - –≤–≤–æ–¥–∏—Ç–µ –∫–æ–¥ - –≥–æ—Ç–æ–≤–æ!

### –ê –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–ª –¥–æ—Å—Ç—É–ø –∫ email/telegram?
–ù—É–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ support (future feature).

### –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª–∏?
–ú–æ–∂–Ω–æ, –Ω–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º—É. –ö–æ–¥—ã - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç **–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π** - –ø—Ä–æ—Å—Ç–æ, –±—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ!

---

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã:** 10 —Ñ–∞–π–ª–æ–≤
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ —É–±—Ä–∞–Ω–æ:** ~200
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~150
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** -30%

**Happy coding!** üöÄ
